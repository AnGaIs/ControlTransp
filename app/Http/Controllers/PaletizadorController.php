<?php

namespace App\Http\Controllers;

use Illuminate\Support\Collection;
use Illuminate\Support\Facades\DB;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Input;
use Session;
use Auth;
use Redirect;
use \App\Logs;
use \App\Permissions;
use \App\Ocs;


class PaletizadorController extends Controller
{

    private $ocs;
    private $totalPage = 10;

    public function __construct(Ocs $ocs)
    {
        $this->ocs = $ocs;
    }


     /**
     * Display a listing of the resource.
     *
     * @return \Illuminate\Http\Response
     */

    public function index(Request $request)
    {
        $logged = Auth::user();

        if (Permissions::permissaoModerador($logged)) {
            $ocs = Ocs::all();
        } else {
            $ocs = Ocs::where('r_auth', $logged->id)->get();
        }

        Logs::cadastrar(Auth::user()->id, (Auth::user()->name . ' Paletizou uma Oc'));
        
        /*
        * Algorithm Palletz!
        */
        
        /*
        * Setor S1
        */
        
        $s1_itens = [99, 100, 122, 123, 125, 127, 128, 129, 130, 134, 136, 140, 141, 587, 1271, 1272, 1290,
    10, 34, 50, 52, 62, 63, 67, 71, 72, 158, 162, 198, 199, 201, 203, 205, 207, 208, 209, 406, 407, 409, 417,
    419, 641, 792, 846, 1268, 1302, 1702]; 
        $s1_street = (
            ['A01001A01','A01003A01','A01005A01','A01007A01','A01009A01','A01011A01',
            'A01013A01','A01015A01','A01017A01','A01019A01','A01021A01','A01023A01',
            'A01025A01','A01027A01','A01035A01','A01037A01','A01039A01','A01041A01',
            'A01043A01','A01045A01','A01047A01','A01049A01','A01051A01','A01053A01',
            'A01055A01','A01057A01','A01059A01','A01061A01','A01063A01','A01065A01',
            'A01067A01','A01069A01','A01071A01','A01073A01','A01075A01','A02001A01',
            'A02002A01','A02003A01','A02004A01','A02005A01','A02006A01','A02007A01',
            'A02008A01','A02009A01','A02010A01','A02011A01','A02012A01','A02013A01',
            'A02014A01','A02015A01','A02016A01','A02017A01','A02018A01','A02019A01',
            'A02020A01','A02021A01','A02022A01','A02023A01','A02024A01','A02025A01',
            'A02026A01','A02027A01','A02028A01','A02033A01','A02034A01','A02035A01',
            'A02036A01','A02037A01','A02038A01','A02039A01','A02040A01','A02041A01',
            'A02042A01','A02043A01','A02044A01','A02045A01','A02046A01','A02047A01',
            'A02048A01','A02049A01','A02050A01','A02051A01','A02052A01','A02053A01',
            'A02054A01','A02055A01','A02056A01','A02057A01','A02058A01','A02059A01',
            'A02060A01','A02061A01','A02062A01','A02063A01','A02064A01','A02065A01',
            'A02066A01','A02067A01','A02068A01','A02069A01','A02070A01','A02071A01',
            'A02072A01','A02073A01','A02074A01','A02075A01','A02076A01','A03001A01',
            'A03002A01','A03003A01','A03004A01','A03005A01','A03006A01','A03007A01',
            'A03008A01','A03009A01','A03010A01','A03011A01','A03012A01','A03013A01',
            'A03014A01','A03015A01','A03016A01','A03017A01','A03018A01','A03019A01',
            'A03020A01','A03021A01','A03022A01','A03023A01','A03024A01','A03025A01',
            'A03026A01','A03027A01','A03027A02','A03028A01','A03037A01','A03038A01',
            'A03039A01','A03040A01','A03041A01','A03042A01','A03043A01','A03044A01',
            'A03045A01','A03046A01','A03047A01','A03048A01','A03049A01','A03050A01',
            'A03051A01','A03052A01','A03053A01','A03054A01','A03055A01','A03056A01',
            'A03057A01','A03058A01','A03059A01','A03060A01','A03061A01','A03062A01',
            'A03063A01','A03064A01','A03065A01','A03066A01','A03067A01','A03068A01',
            'A03069A01','A03070A01','A03071A01','A03072A01','A03073A01','A03074A01',
            'A03075A01','A03076A01',
    
            ]
        ); 

        $s1 = DB::table('ocs')
        ->whereIn('code', $s1_itens)->whereIn('street', $s1_street)->orderBy('cubt', '0.468000')
        ->get();


        /*
        * Setor S2
        */

        $s2_itens = [235, 242, 248, 264, 270, 276, 283, 287, 292, 1683, 1684, 1692, 1694, 1695, 1770, 1781, 1794,
    30, 32, 152, 157, 230, 238, 249, 258, 260, 268, 270, 274, 279, 1261, 1543, 1547, 1681, 1685, 1686, 1687, 1688,
1691, 1745, 1746, 1747, 1749, 1750, 1752, 1761, 1762, 1773, 1774, 1776, 1777, 1778, 1779, 1784, 1786, 1790,
1792, 1811, 1812, 1813, 1821]; 
        $s2_street = (
            [
            'A04001A01','A04002A01','A04003A01','A04004A01',
            'A04005A01','A04006A01','A04007A01','A04008A01','A04009A01','A04010A01',
            'A04011A01','A04012A01','A04013A01','A04014A01','A04015A01','A04016A01',
            'A04017A01','A04018A01','A04019A01','A04020A01','A04021A01','A04022A01',
            'A04023A01','A04024A01','A04025A01','A04026A01','A04027A01','A04028A01',
            'A04037A01','A04038A01','A04039A01','A04040A01','A04041A01','A04042A01',
            'A04043A01','A04044A01','A04045A01','A04046A01','A04047A01','A04048A01',
            'A04049A01','A04050A01','A04051A01','A04052A01','A04053A01','A04054A01',
            'A04055A01','A04056A01','A04057A01','A04058A01','A04059A01','A04060A01',
            'A04061A01','A04062A01','A04063A01','A04064A01','A04065A01','A04066A01',
            'A04067A01','A04068A01','A04069A01','A04070A01','A04071A01','A04072A01',
            'A04073A01','A04074A01','A04075A01','A04076A01','A05001A01','A05002A01',
            'A05003A01','A05004A01','A05005A01','A05006A01','A05007A01','A05008A01',
            'A05009A01','A05010A01','A05011A01','A05012A01','A05013A01','A05014A01',
            'A05015A01','A05016A01','A05017A01','A05018A01','A05019A01','A05020A01',
            'A05021A01','A05022A01','A05023A01','A05024A01','A05025A01','A05026A01',
            'A05027A01','A05028A01','A05037A01','A05038A01','A05039A01','A05040A01',
            'A05041A01','A05042A01','A05043A01','A05044A01','A05045A01','A05046A01',
            'A05047A01','A05048A01','A05049A01','A05050A01','A05051A01','A05052A01',
            'A05053A01','A05054A01','A05055A01','A05056A01','A05057A01','A05058A01',
            'A05059A01','A05060A01','A05061A01','A05062A01','A05063A01','A05064A01',
            'A05065A01','A05066A01','A05067A01','A05068A01','A05069A01','A05070A01',
            'A05071A01','A05072A01','A05073A01','A05074A01','A05075A01','A05076A01',
    
            ]
        ); 

        $s2 = DB::table('ocs')
        ->whereIn('code', $s2_itens)->whereIn('street', $s2_street)->orderBy('cubt', '<=', '0,468000')
        ->get();

        /*
        * Setor S3
        */

        $s3_itens = [307, 321, 334, 1753, 1844, 1846, 1850,
    308, 324, 327, 329, 335]; 
        $s3_street = (
            [
                'A06001A01','A06002A01','A06003A01','A06004A01','A06005A01','A06006A01',
                'A06007A01','A06008A01','A06009A01','A06010A01','A06011A01','A06012A01',
                'A06013A01','A06014A01','A06015A01','A06016A01','A06017A01','A06018A01',
                'A06019A01','A06020A01','A06021A01','A06022A01','A06023A01','A06024A01',
                'A06025A01','A06026A01','A06027A01','A06028A01','A06037A01','A06038A01',
                'A06039A01','A06040A01','A06041A01','A06042A01','A06043A01','A06044A01',
                'A06045A01','A06046A01','A06047A01','A06048A01','A06049A01','A06050A01',
                'A06051A01','A06052A01','A06053A01','A06054A01','A06055A01','A06056A01',
                'A06057A01','A06058A01','A06059A01','A06060A01','A06061A01','A06062A01',
                'A06063A01','A06064A01','A06065A01','A06066A01','A06067A01','A06068A01',
                'A06069A01','A06070A01','A06071A01','A06072A01','A06074A01','A06076A01',
                'A07001A01','A07002A01','A07003A01','A07004A01','A07005A01','A07006A01',
                'A07007A01','A07008A01','A07009A01','A07010A01','A07011A01','A07012A01',
                'A07013A01','A07014A01','A07015A01','A07016A01','A07017A01','A07018A01',
                'A07019A01','A07020A01','A07021A01','A07022A01','A07023A01','A07024A01',
                'A07025A01','A07026A01','A07027A01','A07028A01','A07037A01','A07038A01',
                'A07039A01','A07040A01','A07041A01','A07042A01','A07043A01','A07044A01',
                'A07045A01','A07046A01','A07047A01','A07048A01','A07049A01','A07050A01',
                'A07051A01','A07052A01','A07053A01','A07054A01','A07055A01','A07056A01',
                'A07057A01','A07058A01','A07059A01','A07060A01','A07061A01','A07062A01',
                'A07063A01','A07064A01','A07065A01','A07066A01','A07067A01','A07068A01',
                'A07069A01','A07070A01','A07071A01','A07072A01',
    
            ]
        ); 

        $s3 = DB::table('ocs')
        ->whereIn('code', $s3_itens)->whereIn('street', $s3_street)->orderBy('cubt', '<=', '0,468000')
        ->get();


        /*
        * Setor S4
        */

        $s4_itens = [2, 3, 168, 170, 331, 337, 338, 342, 343, 345, 842, 843, 1318]; 
        $s4_street = (
            [
                'A08001A01','A08002A01',
                'A08003A01','A08004A01','A08005A01','A08006A01','A08007A01','A08008A01',
                'A08009A01','A08010A01','A08011A01','A08012A01','A08013A01','A08014A01',
                'A08015A01','A08016A01','A08017A01','A08018A01','A08019A01','A08020A01',
                'A08021A01','A08022A01','A08023A01','A08024A01','A08025A01','A08026A01',
                'A08027A01','A08028A01','A08037A01','A08038A01','A08039A01','A08040A01',
                'A08041A01','A08042A01','A08043A01','A08044A01','A08045A01','A08046A01',
                'A08047A01','A08048A01','A08049A01','A08050A01','A08051A01','A08052A01',
                'A08053A01','A08054A01','A08055A01','A08056A01','A08057A01','A08058A01',
                'A08059A01','A08060A01','A08061A01','A08062A01','A08063A01','A08064A01',
                'A08065A01','A08066A01','A08067A01','A08068A01','A08069A01','A08070A01',
                'A08071A01','A08072A01',
    
            ]
        ); 

        $s4 = DB::table('ocs')
        ->whereIn('code', $s4_itens)->whereIn('street', $s4_street)->orderBy('cubt', '<=', '0,468000')
        ->get();

        $altp1 = $request->input('altp1', 4);
        $altp2 = $request->input('altp2', 3);
        $altp3 = $request->input('altp3', 2);
        $altp4 = $request->input('altp4', 2);


        return view('paletizador.index', ['ocs' => $ocs], compact('s1', 's2', 's3', 's4', 'altp1', 'altp2', 'altp3', 'altp4'));
    }

}